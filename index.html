<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SDU Shield Explorer</title>
  <style>
    html, body { height:100%; margin:0; font-family: monospace; background:#1e1e1e; color:#ddd; }
    .grid { display: grid; grid-template-columns: 250px 1fr; grid-template-rows: auto auto 1fr; grid-template-areas:
               "sidebar header"
               "sidebar controls"
               "sidebar viewer"; height:100%; }
    #sidebar { grid-area: sidebar; background:#2d2d2d; padding:10px; overflow-y:auto; }
    #sidebar h3 { margin-top:0; }
    #sidebar ul { list-style:none; padding-left:10px; margin:0; }
    #sidebar li { cursor:pointer; user-select:none; margin:4px 0; }
    #sidebar li.folder::before { content:"üìÅ "; }
    #sidebar li.file::before { content:"üìÑ "; }
    #header { grid-area: header; display:flex; align-items:center; background:#333; padding:8px; }
    #header button { background:#444; color:#fff; border:none; padding:4px 8px; margin-right:8px; cursor:pointer; }
    #header button:disabled { opacity:0.4; cursor:default; }
    #path { flex:1; color:#569cd6; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    #controls { grid-area: controls; display:flex; align-items:center; background:#333; padding:4px 8px; border-bottom:1px solid #444; }
    #controls button { background:#444; color:#fff; border:none; padding:4px 8px; margin-left:4px; cursor:pointer; }
    #controls input { padding:4px; margin-left:auto; background:#222; border:1px solid #444; color:#ddd; }
    #viewer { grid-area: viewer; padding:12px; overflow-y:auto; background:#252526; }
    #doc-view { white-space:pre-wrap; background:#1e1e1e; padding:8px; border:1px solid #444; }
  </style>
</head>
<body>
  <div class="grid">
    <div id="sidebar"><h3>Files</h3><ul id="tree"></ul></div>
    <div id="header">
      <button id="back">‚óÄ</button>
      <button id="forward">‚ñ∂</button>
      <span id="path">Loading...</span>
    </div>
    <div id="controls">
      <button id="refresh">üîÑ Refresh</button>
      <input id="search" placeholder="Search..." />
      <button id="search-btn">üîç</button>
    </div>
    <div id="viewer"><div id="doc-view">Select a file or folder</div></div>
  </div>
  <script>
    let treeData = {};
    let hist = [], pos = -1;
    const treeEl = document.getElementById('tree');
    const docView = document.getElementById('doc-view');
    const pathEl = document.getElementById('path');
    const backBtn = document.getElementById('back');
    const fwdBtn = document.getElementById('forward');
    const searchEl = document.getElementById('search');
    const searchBtn = document.getElementById('search-btn');
    const refreshBtn = document.getElementById('refresh');

    function updateNav() {
      backBtn.disabled = pos <= 0;
      fwdBtn.disabled = pos >= hist.length - 1;
    }

    function pushHistory(path) {
      if (hist[pos] !== path) {
        hist = hist.slice(0, pos+1);
        hist.push(path);
        pos = hist.length - 1;
      }
      updateNav();
    }

    function renderTree(node, ul, prefix='') {
      ul.innerHTML = '';
      Object.keys(node).forEach(key => {
        const li = document.createElement('li');
        const full = prefix ? prefix + '/' + key : key;
        li.textContent = key;
        li.className = typeof node[key] === 'object' ? 'folder' : 'file';
        li.onclick = e => { e.stopPropagation(); navigate(full); };
        ul.appendChild(li);
        if (typeof node[key] === 'object') {
          const child = document.createElement('ul');
          li.appendChild(child);
          renderTree(node[key], child, full);
        }
      });
    }

    async function navigate(path) {
      if (!treeData) return;
      pushHistory(path);
      pathEl.textContent = path;
      const parts = path.split('/');
      let node = treeData;
      for (const p of parts) node = node[p];
      if (typeof node === 'object') {
        renderTree(treeData, treeEl);
        docView.textContent = 'Directory: ' + path;
      } else {
        try {
          const res = await fetch(path);
          const text = await res.text();
          docView.textContent = text;
        } catch {
          docView.textContent = 'Error loading file';
        }
      }
    }

    async function loadTree() {
      try {
        const res = await fetch('file_tree.json');
        treeData = await res.json();
        renderTree(treeData, treeEl);
        const start = Object.keys(treeData)[0] || '';
        navigate(start);
      } catch {
        pathEl.textContent = 'Failed to load tree';
      }
    }

    backBtn.onclick = () => { if (pos>0) navigate(hist[--pos]); };
    fwdBtn.onclick = () => { if (pos<hist.length-1) navigate(hist[++pos]); };
    searchBtn.onclick = () => {
      const term = searchEl.value.toLowerCase();
      document.querySelectorAll('#tree li').forEach(li => {
        li.style.display = li.textContent.toLowerCase().includes(term) ? '' : 'none';
      });
    };
    refreshBtn.onclick = loadTree;
    window.onload = loadTree;
  </script>
</body>
</html>
